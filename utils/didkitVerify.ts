import { ethers } from "ethers";

const preparedCredential = {"proof":{"@context":"https://w3id.org/security/suites/eip712sig-2021/v1","type":"EthereumEip712Signature2021","proofPurpose":"assertionMethod","verificationMethod":"did:ethr:0xd6fc34345bc8c8e5659a35bed9629d5558d48c4e#controller","created":"2022-10-18T01:16:52.315Z","eip712Domain":{"domain":{"name":"Passport"},"primaryType":"Document","types":{"CredentialSubject":[{"name":"hash","type":"string"},{"name":"id","type":"string"},{"name":"provider","type":"string"}],"Document":[{"name":"@context","type":"string"},{"name":"credentialSubject","type":"CredentialSubject"},{"name":"domain","type":"Domain"},{"name":"expirationDate","type":"string"},{"name":"issuanceDate","type":"string"},{"name":"issuer","type":"string"},{"name":"proof","type":"Proof"},{"name":"type","type":"string[]"}],"Domain":[{"name":"name","type":"string"}],"EIP712Domain":[{"name":"name","type":"string"}],"Proof":[{"name":"@context","type":"string"},{"name":"created","type":"string"},{"name":"proofPurpose","type":"string"},{"name":"type","type":"string"},{"name":"verificationMethod","type":"string"}]}}},"jwsHeader":null,"signingInput":{"types":{"EIP712Domain":[{"type":"string","name":"name"}],"CredentialSubject":[{"type":"string","name":"hash"},{"type":"string","name":"id"},{"type":"string","name":"provider"}],"Document":[{"type":"string","name":"@context"},{"type":"CredentialSubject","name":"credentialSubject"},{"type":"Domain","name":"domain"},{"type":"string","name":"expirationDate"},{"type":"string","name":"issuanceDate"},{"type":"string","name":"issuer"},{"type":"Proof","name":"proof"},{"type":"string[]","name":"type"}],"Proof":[{"type":"string","name":"@context"},{"type":"string","name":"created"},{"type":"string","name":"proofPurpose"},{"type":"string","name":"type"},{"type":"string","name":"verificationMethod"}],"Domain":[{"type":"string","name":"name"}]},"primaryType":"Document","domain":{"name":"Passport"},"message":{"@context":"https://www.w3.org/2018/credentials/v1","credentialSubject":{"hash":"v0.0.0:AjcRjxx7Hp3PKPSNwPeBJjR21pLyA14CVeQ1XijzxUc=","id":"did:pkh:eip155:1:0x12FeD9f987bc340c6bE43fD80aD641E8cD740682","provider":"Twitter"},"expirationDate":"2022-10-17T10:42:24.883Z","issuanceDate":"2022-07-19T10:42:24.883Z","issuer":"did:ethr:0xd6fc34345bc8c8e5659a35bed9629d5558d48c4e","proof":{"@context":"https://w3id.org/security/suites/eip712sig-2021/v1","created":"2022-10-18T01:16:52.315Z","proofPurpose":"assertionMethod","type":"EthereumEip712Signature2021","verificationMethod":"did:ethr:0xd6fc34345bc8c8e5659a35bed9629d5558d48c4e#controller"},"type":["VerifiableCredential"]}}}

const signedCredential = {"@context":"https://www.w3.org/2018/credentials/v1","type":["VerifiableCredential"],"credentialSubject":{"id":"did:pkh:eip155:1:0x12FeD9f987bc340c6bE43fD80aD641E8cD740682","provider":"Twitter","hash":"v0.0.0:AjcRjxx7Hp3PKPSNwPeBJjR21pLyA14CVeQ1XijzxUc="},"issuer":"did:ethr:0xd6fc34345bc8c8e5659a35bed9629d5558d48c4e","issuanceDate":"2022-07-19T10:42:24.883Z","proof":{"@context":"https://w3id.org/security/suites/eip712sig-2021/v1","type":"EthereumEip712Signature2021","proofPurpose":"assertionMethod","proofValue":"0x9d19d707bd0a48f15826d6b3f23bbcfdd007ddccca809ea40952fee5e643ab5d13e7440177b080f93e4aa0b2658b03dc50bab24879af86c77ae85d022003d46b1b","verificationMethod":"did:ethr:0xd6fc34345bc8c8e5659a35bed9629d5558d48c4e#Eip712Method2021","created":"2022-10-18T01:16:52.317Z","eip712Domain":{"domain":{"name":"Passport"},"primaryType":"Document","types":{"CredentialSubject":[{"name":"hash","type":"string"},{"name":"id","type":"string"},{"name":"provider","type":"string"}],"Document":[{"name":"@context","type":"string"},{"name":"credentialSubject","type":"CredentialSubject"},{"name":"domain","type":"Domain"},{"name":"expirationDate","type":"string"},{"name":"issuanceDate","type":"string"},{"name":"issuer","type":"string"},{"name":"proof","type":"Proof"},{"name":"type","type":"string[]"}],"Domain":[{"name":"name","type":"string"}],"EIP712Domain":[{"name":"name","type":"string"}],"Proof":[{"name":"@context","type":"string"},{"name":"created","type":"string"},{"name":"proofPurpose","type":"string"},{"name":"type","type":"string"},{"name":"verificationMethod","type":"string"}]}}},"expirationDate":"2022-10-17T10:42:24.883Z"}

const options = {
	"type": "EthereumEip712Signature2021",
	"domain": "issuer.interop.transmute.world"
}

console.log({ preparedCredential, signedCredential }, "stringified:::  ", JSON.stringify(options, undefined, 2))

async function verifyCredential() {
  // domain: TypedDataDomain, types: Record<string, Array<TypedDataField>>, value: Record<string, any>, signature: SignatureLike
	const signerAddress = ethers.utils.verifyTypedData({}, preparedCredential.signingInput.types, signedCredential, signedCredential.proof.proofValue)
	console.log({ signerAddress })
}

verifyCredential()